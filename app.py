# ============================================
# ๐ฟ Argan Package Smart Script Generator v1
# ุงููุงุชุจ: ุฏ. ูุญูุฏ ุงููุถุงู
# ุงููุตู: ุชุทุจูู ุชูููุฏ ุณูุฑุจุชุงุช ุชุณููููุฉ ุจุงูููุฌุฉ ุงูุณุนูุฏูุฉ
# ============================================

import streamlit as st
import openai
import datetime

# ุฅุนุฏุงุฏ ุงููุงุฌูุฉ
st.set_page_config(
    page_title="Argan Package Script Generator",
    page_icon="๐ฟ",
    layout="centered"
)

# ุชุฑููุณุฉ ุงูุตูุญุฉ
st.title("๐ฟ Argan Package Smart Script Generator")
st.markdown("##### โจ ูุธุงู ุชูููุฏ ุณูุฑุจุชุงุช ุชุณููููุฉ ุจุงูููุฌุฉ ุงูุณุนูุฏูุฉ ๐ธ๐ฆ")
st.markdown("---")

# ุฅุฏุฎุงู ููุงุชูุญ API (ุชููู ููุฌูุฏุฉ ูู secrets ุนูู Streamlit Cloud)
openai.api_key = st.secrets["OPENAI_API_KEY"]

# ูุงุฌูุฉ ุงูุฅุฏุฎุงู
col1, col2 = st.columns(2)
with col1:
    offer = st.text_input("๐ ุงูุนุฑุถ ุงูุฎุงุต:")
    product = st.text_input("๐งด ุงูููุชุฌ:")
    platform = st.selectbox("๐ฑ ุงูููุตุฉ:", ["Snapchat", "TikTok", "Meta"])
    scenario = st.selectbox("๐ฌ ููุน ุงูุณููุงุฑูู:", ["ุฅุนูุงู ุงูุทูุงู", "ุชุฌุฑุจุฉ ุงูููุชุฌ", "ุชูุนูุฉ", "ููุดู"])

with col2:
    shipping = st.text_input("๐ ุงูุชูุตูู:")
    gift = st.text_input("๐ ุงููุฏูุฉ:")
    cashback = st.text_input("๐ธ ุงููุงุด ุจุงู (ุงุฎุชูุงุฑู):")
    tone = st.selectbox("๐ค ูุจุฑุฉ ุงููุต:", ["ุทุจูุนูุฉ", "ูุฎูุฉ", "ุนูููุฉ", "ุฃูุซููุฉ", "ุชุญููุฒูุฉ"])

custom_inst = st.text_area("๐ ุชุนูููุงุช ุฅุถุงููุฉ:", placeholder="ูุซูุงู: ุงุฌุนู ุงููุต ูุตูุฑูุงุ ุจุงูููุฌุฉ ุงูุณุนูุฏูุฉุ ูุงุจุฏุฃ ุจุฌููุฉ ูุดููุฉ...")

st.markdown("---")

# ุฒุฑ ุงูุชูููุฐ
if st.button("๐ง ุชูููุฏ ุงูุณูุฑุจุช ุงูุขู"):
    if not all([offer, product, platform, scenario, shipping, gift, custom_inst]):
        st.error("โ๏ธ ุงูุฑุฌุงุก ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ุงููุทููุจุฉ ูุจู ุงูุชูููุฏ.")
    else:
        with st.spinner("โ๏ธ ุฌุงุฑู ุฅูุดุงุก ุงูุณูุฑุจุช..."):
            # ุฅูุดุงุก ุงูุจุฑููุช ุงูุฐูู
            prompt = f"""
ุงูุชุจ ุณูุฑุจุช ุชุณูููู ุจุงูููุฌุฉ ุงูุณุนูุฏูุฉ ูููุชุฌ "{product}" ููุงุณุจ ูููุตุฉ {platform}.
ููุน ุงูุณููุงุฑูู: {scenario}.
ูุจุฑุฉ ุงููุต: {tone}.

๐ ุงูุนุฑุถ: {offer}
๐ ุงูุชูุตูู: {shipping}
๐ ุงููุฏูุฉ: {gift}
๐ธ ุงููุงุด ุจุงู: {cashback if cashback else "ูุง ููุฌุฏ"}
๐ ุชุนูููุงุช ุฅุถุงููุฉ: {custom_inst}

โณ๏ธ ุงููุชุทูุจุงุช:
- ุณูุฑุจุช ูุตูุฑ ูุง ูุชุฌุงูุฒ 30 ุซุงููุฉ.
- ูุจุฏุฃ ุจุฌููุฉ ูููุฉ ุชุดุฏ ุงูุงูุชุจุงู.
- ููุทูู ููุชุฑุงุจุท.
- ููุฌุฉ ุณุนูุฏูุฉ ุทุจูุนูุฉ ููุงุซูุฉ.
- ุฎุชุงู ุจุฏุนูุฉ ูููุนู ููุงุณุจุฉ ููููุตุฉ ({platform}).
- ุงุฌุนู ุงูุณูุฑุจุช ูุฎุชูู ุนู ุฃู ุณูุฑุจุช ุนุงู ุฃู ููุทู.
"""

            # ุงุณุชุฏุนุงุก OpenAI
            try:
                res = openai.ChatCompletion.create(
                    model="gpt-4o-mini",
                    messages=[
                        {"role": "system", "content": "ุฃูุช ูุงุชุจ ูุญุชูู ุชุณูููู ุณุนูุฏู ูุญุชุฑู ูุชุฎุตุต ูู ุณูุงุจ ุดุงุช ูุชูู ุชูู ููุชุงุจุน ูุณูุงุณุงุช ุงูููุตุงุช."},
                        {"role": "user", "content": prompt}
                    ]
                )
                script = res.choices[0].message.content.strip()

                # ุนุฑุถ ุงููุชูุฌุฉ
                st.success("โ ุชู ุชูููุฏ ุงูุณูุฑุจุช ุจูุฌุงุญ!")
                st.markdown(f"### ๐งพ ุงูุณูุฑุจุช ุงููุงุชุฌ:")
                st.text_area("๐ ุงููุต ุงูููุงุฆู:", script, height=300)
                
                # ุฃุฒุฑุงุฑ ุงููุณุฎ ูุงูุชูุฒูู
                st.download_button("๐ฅ ุชุญููู ุงููุต ูููู TXT", data=script, file_name=f"{product}_script.txt")

                # ุชูููุน
                st.markdown("---")
                st.caption(f"ุชู ุฅุนุฏุงุฏ ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ ูุญูุฏ ุงููุถุงู โข Argan Package โข {datetime.datetime.now().strftime('%Y/%m/%d %H:%M')}")
            
            except Exception as e:
                st.error(f"โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจู OpenAI: {e}")
